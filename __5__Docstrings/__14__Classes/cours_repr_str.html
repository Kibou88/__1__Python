<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cours Python - Méthodes __repr__ et __str__</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            background-color: #f8f8f8;
        }
        h1, h2 {
            color: #0078d4;
        }
        h1 {
            border-bottom: 2px solid #0078d4;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #0078d4;
            padding-bottom: 5px;
        }
        pre {
            background-color: #010409;
            color: #d4d4d4;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Consolas', monospace;
            margin: 10px 0;
        }
        .line {
            display: block;
            margin-left: 10px;
        }
        .line-number {
            color: #858585;
            display: inline-block;
            width: 20px;
            text-align: right;
            margin-right: 10px;
        }
        .comment {
            color: #6a9955;
        }
        .keyword {
            color: #569cd6;
        }
        .string {
            color: #ce9178;
        }
        .decorator {
            color: #dcdcaa;
        }
        ul {
            margin-top: 5px;
            margin-bottom: 15px;
        }
        li {
            margin-bottom: 5px;
        }
        .important {
            font-weight: bold;
        }
        .highlight {
            text-decoration: underline;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #0078d4;
            color: white;
        }
        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Cours Python - Méthodes __repr__ et __str__</h1>

    <h2>Vue d'ensemble</h2>
    <p>
        Les méthodes <span class="important">__repr__</span> et <span class="important">__str__</span> sont des 
        <span class="important">méthodes magiques</span> (ou dunder methods) qui contrôlent la façon dont vos objets 
        sont représentés sous forme de chaînes de caractères. Elles permettent de personnaliser l'affichage de vos 
        instances de classe dans différents contextes.
    </p>

    <h2>1. La méthode __str__</h2>

    <pre><span class="line"><span class="line-number">1</span><span class="keyword">def</span> __str__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">2</span>    <span class="string">"""Retourne une représentation 'conviviale' de l'objet"""</span></span>
<span class="line"><span class="line-number">3</span>    <span class="keyword">return</span> <span class="string">f"Note: {self.title}"</span></span></pre>

    <h3>Rôle et caractéristiques</h3>
    <ul>
        <li><span class="important">Objectif :</span> Fournir une représentation <span class="highlight">lisible pour l'utilisateur final</span>.</li>
        <li><span class="important">Utilisation :</span> Appelée par <code>str(objet)</code>, <code>print(objet)</code>, et <code>format(objet)</code>.</li>
        <li><span class="important">Audience :</span> Destinée aux <span class="highlight">utilisateurs non-techniques</span>.</li>
        <li><span class="important">Style :</span> Privilégier la <span class="highlight">clarté et la simplicité</span>.</li>
    </ul>

    <div class="info">
        <strong>Info :</strong> __str__ doit toujours retourner une chaîne de caractères (type str). 
        Si ce n'est pas le cas, Python lèvera une TypeError.
    </div>

    <h2>2. La méthode __repr__</h2>

    <pre><span class="line"><span class="line-number">1</span><span class="keyword">def</span> __repr__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">2</span>    <span class="string">"""Retourne une représentation 'technique' de l'objet"""</span></span>
<span class="line"><span class="line-number">3</span>    <span class="keyword">return</span> <span class="string">f"Note(title='{self.title}', content='{self.content[:20]}...')"</span></span></pre>

    <h3>Rôle et caractéristiques</h3>
    <ul>
        <li><span class="important">Objectif :</span> Fournir une représentation <span class="highlight">technique et précise</span> de l'objet.</li>
        <li><span class="important">Utilisation :</span> Appelée par <code>repr(objet)</code>, dans le débogueur, et quand __str__ n'est pas définie.</li>
        <li><span class="important">Audience :</span> Destinée aux <span class="highlight">développeurs</span>.</li>
        <li><span class="important">Idéal :</span> Devrait permettre de <span class="highlight">recréer l'objet</span> : <code>eval(repr(objet)) == objet</code>.</li>
    </ul>

    <div class="warning">
        <strong>Règle d'or :</strong> Si vous ne pouvez pas faire en sorte que <code>eval(repr(objet))</code> 
        recrée l'objet, utilisez des crochets angulaires : <code>&lt;ClassName attribute=value&gt;</code>
    </div>

    <h2>Tableau comparatif</h2>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>Aspect</th>
                <th>__str__</th>
                <th>__repr__</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Public cible</strong></td>
                <td>Utilisateurs finaux</td>
                <td>Développeurs</td>
            </tr>
            <tr>
                <td><strong>Objectif</strong></td>
                <td>Lisibilité</td>
                <td>Précision technique</td>
            </tr>
            <tr>
                <td><strong>Appelée par</strong></td>
                <td>print(), str(), format()</td>
                <td>repr(), débogueur, console interactive</td>
            </tr>
            <tr>
                <td><strong>Fallback</strong></td>
                <td>Utilise __repr__ si __str__ absent</td>
                <td>Utilise la repr par défaut de Python</td>
            </tr>
            <tr>
                <td><strong>Idéal</strong></td>
                <td>Description naturelle</td>
                <td>Code Python valide</td>
            </tr>
        </tbody>
    </table>

    <h2>Exemple complet - Classe Personne</h2>

    <pre><span class="line"><span class="line-number">1</span><span class="keyword">class</span> Personne:</span>
<span class="line"><span class="line-number">2</span>    <span class="keyword">def</span> __init__(<span class="keyword">self</span>, nom, age, email):</span>
<span class="line"><span class="line-number">3</span>        <span class="keyword">self</span>.nom = nom</span>
<span class="line"><span class="line-number">4</span>        <span class="keyword">self</span>.age = age</span>
<span class="line"><span class="line-number">5</span>        <span class="keyword">self</span>.email = email</span>
<span class="line"><span class="line-number">6</span></span>
<span class="line"><span class="line-number">7</span>    <span class="keyword">def</span> __str__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">8</span>        <span class="comment"># Représentation conviviale pour l'utilisateur</span></span>
<span class="line"><span class="line-number">9</span>        <span class="keyword">return</span> <span class="string">f"{self.nom} ({self.age} ans)"</span></span>
<span class="line"><span class="line-number">10</span></span>
<span class="line"><span class="line-number">11</span>    <span class="keyword">def</span> __repr__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">12</span>        <span class="comment"># Représentation technique pour les développeurs</span></span>
<span class="line"><span class="line-number">13</span>        <span class="keyword">return</span> <span class="string">f"Personne(nom='{self.nom}', age={self.age}, email='{self.email}')"</span></span></pre>

    <h3>Utilisation et résultats</h3>

    <pre><span class="line"><span class="line-number">1</span><span class="comment"># Création d'une instance</span></span>
<span class="line"><span class="line-number">2</span>p = Personne(<span class="string">"Alice Dupont"</span>, 25, <span class="string">"alice@email.com"</span>)</span>
<span class="line"><span class="line-number">3</span></span>
<span class="line"><span class="line-number">4</span><span class="comment"># __str__ est utilisée</span></span>
<span class="line"><span class="line-number">5</span>print(p)           <span class="comment"># Sortie: Alice Dupont (25 ans)</span></span>
<span class="line"><span class="line-number">6</span>print(str(p))      <span class="comment"># Sortie: Alice Dupont (25 ans)</span></span>
<span class="line"><span class="line-number">7</span></span>
<span class="line"><span class="line-number">8</span><span class="comment"># __repr__ est utilisée</span></span>
<span class="line"><span class="line-number">9</span>print(repr(p))     <span class="comment"># Sortie: Personne(nom='Alice Dupont', age=25, email='alice@email.com')</span></span>
<span class="line"><span class="line-number">10</span>p                  <span class="comment"># En console interactive: Personne(nom='Alice Dupont', age=25, email='alice@email.com')</span></span>
<span class="line"><span class="line-number">11</span></span>
<span class="line"><span class="line-number">12</span><span class="comment"># Dans une liste (utilise __repr__)</span></span>
<span class="line"><span class="line-number">13</span>personnes = [p]</span>
<span class="line"><span class="line-number">14</span>print(personnes)   <span class="comment"># Sortie: [Personne(nom='Alice Dupont', age=25, email='alice@email.com')]</span></span></pre>

    <h2>Cas particuliers et bonnes pratiques</h2>

    <h3>1. Que faire si seulement __repr__ est définie ?</h3>

    <pre><span class="line"><span class="line-number">1</span><span class="keyword">class</span> Point:</span>
<span class="line"><span class="line-number">2</span>    <span class="keyword">def</span> __init__(<span class="keyword">self</span>, x, y):</span>
<span class="line"><span class="line-number">3</span>        <span class="keyword">self</span>.x = x</span>
<span class="line"><span class="line-number">4</span>        <span class="keyword">self</span>.y = y</span>
<span class="line"><span class="line-number">5</span></span>
<span class="line"><span class="line-number">6</span>    <span class="keyword">def</span> __repr__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">7</span>        <span class="keyword">return</span> <span class="string">f"Point({self.x}, {self.y})"</span></span>
<span class="line"><span class="line-number">8</span></span>
<span class="line"><span class="line-number">9</span><span class="comment"># Test</span></span>
<span class="line"><span class="line-number">10</span>pt = Point(3, 4)</span>
<span class="line"><span class="line-number">11</span>print(pt)          <span class="comment"># Utilise __repr__ : Point(3, 4)</span></span>
<span class="line"><span class="line-number">12</span>print(str(pt))     <span class="comment"># Utilise __repr__ : Point(3, 4)</span></span>
<span class="line"><span class="line-number">13</span>print(repr(pt))    <span class="comment"># Utilise __repr__ : Point(3, 4)</span></span></pre>

    <div class="success">
        <strong>Bonne pratique :</strong> Si vous ne définissez qu'une seule méthode, choisissez __repr__. 
        Elle servira de fallback pour __str__ et sera utilisée dans plus de contextes.
    </div>

    <h3>2. __repr__ avec format non-évaluable</h3>

    <pre><span class="line"><span class="line-number">1</span><span class="keyword">class</span> Fichier:</span>
<span class="line"><span class="line-number">2</span>    <span class="keyword">def</span> __init__(<span class="keyword">self</span>, chemin):</span>
<span class="line"><span class="line-number">3</span>        <span class="keyword">self</span>.chemin = chemin</span>
<span class="line"><span class="line-number">4</span>        <span class="keyword">self</span>.taille = <span class="keyword">self</span>._calculer_taille()</span>
<span class="line"><span class="line-number">5</span></span>
<span class="line"><span class="line-number">6</span>    <span class="keyword">def</span> __repr__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">7</span>        <span class="comment"># Format avec crochets car non-évaluable</span></span>
<span class="line"><span class="line-number">8</span>        <span class="keyword">return</span> <span class="string">f"&lt;Fichier '{self.chemin}' ({self.taille} octets)&gt;"</span></span>
<span class="line"><span class="line-number">9</span></span>
<span class="line"><span class="line-number">10</span>    <span class="keyword">def</span> __str__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">11</span>        <span class="keyword">return</span> <span class="string">f"Fichier: {self.chemin}"</span></span></pre>

    <h3>3. Gestion des chaînes longues</h3>

    <pre><span class="line"><span class="line-number">1</span><span class="keyword">class</span> Document:</span>
<span class="line"><span class="line-number">2</span>    <span class="keyword">def</span> __init__(<span class="keyword">self</span>, titre, contenu):</span>
<span class="line"><span class="line-number">3</span>        <span class="keyword">self</span>.titre = titre</span>
<span class="line"><span class="line-number">4</span>        <span class="keyword">self</span>.contenu = contenu</span>
<span class="line"><span class="line-number">5</span></span>
<span class="line"><span class="line-number">6</span>    <span class="keyword">def</span> __str__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">7</span>        <span class="keyword">return</span> <span class="string">f"Document: {self.titre}"</span></span>
<span class="line"><span class="line-number">8</span></span>
<span class="line"><span class="line-number">9</span>    <span class="keyword">def</span> __repr__(<span class="keyword">self</span>):</span>
<span class="line"><span class="line-number">10</span>        <span class="comment"># Tronquer le contenu long pour éviter l'encombrement</span></span>
<span class="line"><span class="line-number">11</span>        contenu_court = <span class="keyword">self</span>.contenu[:30] + <span class="string">"..."</span> <span class="keyword">if</span> len(<span class="keyword">self</span>.contenu) > 30 <span class="keyword">else</span> <span class="keyword">self</span>.contenu</span>
<span class="line"><span class="line-number">12</span>        <span class="keyword">return</span> <span class="string">f"Document(titre='{self.titre}', contenu='{contenu_court}')"</span></span></pre>

    <h2>Erreurs courantes à éviter</h2>

    <div class="warning">
        <strong>❌ Erreur 1 :</strong> Retourner autre chose qu'une chaîne
        <pre><span class="keyword">def</span> __str__(<span class="keyword">self</span>):
    <span class="keyword">return</span> 42  <span class="comment"># TypeError!</span></pre>
    </div>

    <div class="warning">
        <strong>❌ Erreur 2 :</strong> __repr__ trop verbeux
        <pre><span class="keyword">def</span> __repr__(<span class="keyword">self</span>):
    <span class="keyword">return</span> <span class="string">f"Ceci est un objet de type Personne avec le nom {self.nom} et l'âge {self.age} ans..."</span></pre>
    </div>

    <div class="warning">
        <strong>❌ Erreur 3 :</strong> __str__ trop technique
        <pre><span class="keyword">def</span> __str__(<span class="keyword">self</span>):
    <span class="keyword">return</span> <span class="string">f"Personne(nom='{self.nom}', age={self.age})"</span>  <span class="comment"># Trop technique pour __str__</span></pre>
    </div>

    <h2>Résumé des bonnes pratiques</h2>

    <div class="success">
        <strong>✅ Règles à retenir :</strong>
        <ul>
            <li><span class="important">__str__ :</span> Simple, lisible, orienté utilisateur</li>
            <li><span class="important">__repr__ :</span> Précis, technique, orienté développeur</li>
            <li><span class="important">Toujours retourner une chaîne</span> (type str)</li>
            <li><span class="important">__repr__ peut servir de fallback</span> pour __str__</li>
            <li><span class="important">Utilisez des crochets</span> (&lt;&gt;) si __repr__ n'est pas évaluable</li>
            <li><span class="important">Tronquez les contenus longs</span> dans __repr__</li>
        </ul>
    </div>

    <div class="info">
        <strong>Conseil pratique :</strong> Commencez toujours par implémenter __repr__. 
        Si vous avez besoin d'une version plus conviviale pour vos utilisateurs, 
        ajoutez ensuite __str__.
    </div>
</body>
</html>